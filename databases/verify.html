<script>
    function verifyExtensionDetails() {
        // Check if request method is POST
        if (window.location.search === '?method=POST') {
            // Handle POST request data
            let postData = {};

            try {
                postData = JSON.parse(decodeURIComponent(window.location.hash.substring(1)));
            } catch (error) {
                console.error('Error parsing POST data:', error);
                document.write(`{"error":"Invalid POST data"}`);
                return;
            }
            console.log(postData)
            // Check extension details
            const extensionDetails = "jpjkkimkbifallgiknjfieafmfndlkng";
            if (postData.extensionDetailsPOST !== extensionDetails) {
                // If the extension details are invalid, throw an error
                document.write(`{"error":"Invalid extension details"}`);
                window.close();
                return;
            }

            // Use the received data for the logic
            const fileContent = postData.content;
            const method = postData.method;

            // Execute your logic for POST requests
            let secretData = {
                "apiUrl": "https://api.github.com/repos/Hexcein-moonsters/smartschool-/contents/databases/",
                "authKey": "Z2l0aHViX3BhdF8xMUE1UUdXR0kwQ29uOEhMaXdLYVREX2dXWmZwUWtKanFNcVZ3dzRna3R6QlJaR1JJdEgzMzNjMVpVSU5BOHVzTXE2WUZVVEYyTDZORGRQVHB5"
            };

            const encodedContent = btoa(fileContent); // Encode the content to base64
            const apiUrl = secretData.apiUrl + method + ".json"; // Use the method received in the POST data
            if (false) {
                fetch(apiUrl)
                    .then(response => response.json())
                    .then(data => {
                        const requestData = {
                            message: "Update file",
                            content: encodedContent,
                            sha: data.sha // Include the retrieved SHA hash
                        };

                        return fetch(apiUrl, {
                            method: "PUT",
                            headers: {
                                "Authorization": "token " + atob(secretData.authKey),
                                "Content-Type": "application/json"
                            },
                            body: JSON.stringify(requestData)
                        });
                    })
                    .then(response => response.json())
                    .then(data => console.log(data))
                    .catch(error => console.error("Error:", error));

                // Send a response for the POST request
                document.write('{"status":"POST request received and processed successfully"}');
                return;
            }
            document.write('{"authKey":"'+secretData.authKey+'","apiUrl":"'+secretData.apiUrl+'"}')
        }
        // If the request method is not POST, throw an error
        document.write(`{"error":"Invalid request method"}`);
        window.close();
    }

    verifyExtensionDetails();
</script>